<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab Directory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/public/styles.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        th { text-transform: uppercase; letter-spacing: 0.05em; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="dashboard-container">
        <aside class="sidebar">
            <h1>Dashboard</h1>
            <nav>
                <ul>
                    <li><a href="index.html#job-submission" class="nav-link">Job Submission</a></li>
                    <li><a href="index.html#all-jobs" class="nav-link">All Jobs</a></li>
                    <li><a href="index.html#reports" class="nav-link">Reports</a></li>
                    <li><a href="directory.html" class="nav-link">Directory</a></li>
                    <li><a href="data_submission.html" class="nav-link">Data Submission</a></li>
                    <li><a href="project_submission.html" class="nav-link">New Project</a></li>
                    <li><a href="profile_creation.html" class="nav-link">New Member</a></li>
                    <li><a href="profile.html" class="nav-link">Account</a></li>
                </ul>
            </nav>
            <div class="user-info">
                <p>Logged in as: <span id="username-display"></span></p>
                <button id="logout-button">Logout</button>
            </div>
        </aside>

        <main class="content" id="content-area">
            <div class="container mx-auto px-4 py-8 md:py-12">

                <div class="text-center mb-10">
                    <h1 class="text-4xl md:text-5xl font-bold text-gray-900">Lab Directory & Projects</h1>
                    <p class="mt-2 text-lg text-gray-600">An overview of our team and current research.</p>
                    <div class="mt-4 flex justify-center gap-4">
                        <a href="/" class="text-indigo-600 hover:text-indigo-800 font-medium">&larr; Register Member</a>
                        <a href="/new_project" class="text-indigo-600 hover:text-indigo-800 font-medium">Register Project</a>
                        <a href="/data_submission" class="text-indigo-600 hover:text-indigo-800 font-medium">Submit Data Log &rarr;</a>
                    </div>
                </div>

                <!-- Lab Members Section -->
                <section id="members-section" class="mb-12">
                    <div class="flex justify-between items-center border-b-2 border-indigo-200 pb-2 mb-4">
                        <h2 class="text-2xl font-bold text-gray-800">Lab Members</h2>
                        <div id="status-filter" class="flex items-center space-x-4 text-sm">
                            <label class="flex items-center"><input type="radio" name="status" value="All" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300" checked> <span class="ml-2">All</span></label>
                            <label class="flex items-center"><input type="radio" name="status" value="Current" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"> <span class="ml-2">Current</span></label>
                            <label class="flex items-center"><input type="radio" name="status" value="Alumn" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300"> <span class="ml-2">Alumni</span></label>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-md overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Role</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Contact</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Projects</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Skills</th>
                                </tr>
                            </thead>
                            <tbody id="members-table-body" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="6" class="p-4 text-center text-gray-500">Loading members...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Projects Section -->
                <section id="projects-section" class="mb-12">
                    <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-indigo-200 pb-2 mb-4">Research Projects</h2>
                    <div class="bg-white p-4 rounded-lg shadow-md overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Project Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Lead</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Year</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500">Methods</th>
                                </tr>
                            </thead>
                            <tbody id="projects-table-body" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="6" class="p-4 text-center text-gray-500">Loading projects...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Documents and Resources Section -->
                <section id="resources-section">
                    <h2 class="text-2xl font-bold text-gray-800 border-b-2 border-indigo-200 pb-2 mb-4">Documents & Shared Resources</h2>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <ul class="list-disc list-inside space-y-2">
                            <li><a href="#" class="text-indigo-600 hover:underline">Lab Safety Protocols (PDF)</a></li>
                            <li><a href="#" class="text-indigo-600 hover:underline">16S Amplicon Sequencing SOP</a></li>
                            <li><a href="#" class="text-indigo-600 hover:underline">Shared Equipment Booking Calendar</a></li>
                            <li><a href="#" class="text-indigo-600 hover:underline">Lab Meeting Minutes (Shared Drive)</a></li>
                            <li><a href="#" class="text-indigo-600 hover:underline">Chemical Inventory Spreadsheet</a></li>
                        </ul>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const membersTableBody = document.getElementById('members-table-body');
            const projectsTableBody = document.getElementById('projects-table-body');
            const statusFilter = document.getElementById('status-filter');

            let allMembers = [];

            function renderMembers(membersToRender) {
                membersTableBody.innerHTML = '';
                if (membersToRender.length === 0) {
                    membersTableBody.innerHTML = '<tr><td colspan="6" class="p-4 text-center text-gray-500">No members match the filter.</td></tr>';
                    return;
                }
                membersToRender.forEach(member => {
                    const row = document.createElement('tr');
                    const statusClass = member.status === 'Current' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-700';
                    row.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap"><div class="font-medium text-gray-900">${member.name || ''}</div></td>
                        <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-700">${member.role || ''}</div></td>
                        <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">${member.status || ''}</span></td>
                        <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-700">${member.email || ''}</div><div class="text-sm text-gray-500">${member.phone || ''}</div></td>
                        <td class="px-6 py-4 text-sm text-gray-700">${member.projects || ''}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${member.skills_str || ''}</td>
                    `;
                    membersTableBody.appendChild(row);
                });
            }

            async function loadMembers() {
                try {
                    const response = await fetch('/api/members');
                    if (!response.ok) throw new Error("Server not reachable");
                    allMembers = await response.json();
                } catch (error) {
                    console.warn('Could not fetch members. Loading dummy data.', error);
                    allMembers = [
                        { name: 'Dr. Kirsten Muller', role: 'Principal Investigator', status: 'Current', email: 'k.muller@university.edu', phone: '123-555-0101', projects: 'All', skills_str: 'Genomics, Grant Writing' },
                        { name: 'Matt Hrycyshyn', role: 'Research Associate', status: 'Current', email: 'm.hrycyshyn@university.edu', phone: '123 234 1235', projects: 'Evolutionary Biology', skills_str: 'Phylogenetics, Data Analysis' },
                        { name: 'Arnold Kwok', role: 'Laboratory/IT Assistant', status: 'Current', email: 'a.kwok@university.edu', phone: '123 456 1234', projects: 'Utikuma Region Study Area, System Administrator', skills_str: 'Data Analysis, Amplicon Sequencing, Linux' },
                        { name: 'Ellen Cameron', role: 'PhD Student', status: 'Alumn', email: 'e.cameron@university.edu', phone: '123-555-0102', projects: 'River Metagenomics 2019', skills_str: 'Metagenomics, R, Bioinformatics' },
                    ];
                }
                renderMembers(allMembers);
            }

            statusFilter.addEventListener('change', (event) => {
                const selectedStatus = event.target.value;
                if (selectedStatus === 'All') {
                    renderMembers(allMembers);
                } else {
                    const filteredMembers = allMembers.filter(member => member.status === selectedStatus);
                    renderMembers(filteredMembers);
                }
            });

            async function loadProjects() {
                try {
                    const response = await fetch('/api/projects');
                    if (!response.ok) throw new Error("Server not reachable");
                    const projects = await response.json();
                    projectsTableBody.innerHTML = '';

                    if (projects.length === 0) {
                        projectsTableBody.innerHTML = '<tr><td colspan="6" class="p-4 text-center text-gray-500">No project data found.</td></tr>';
                        return;
                    }

                    projects.forEach(project => {
                        const row = document.createElement('tr');
                        const statusClass = project.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800';
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-mono text-gray-600">${project.id || ''}</div></td>
                            <td class="px-6 py-4 whitespace-nowrap"><div class="font-medium text-gray-900">${project['project-name'] || ''}</div></td>
                            <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-700">${project['project-lead'] || ''}</div></td>
                            <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-700">${project.year || ''}</div></td>
                            <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">${project.status || ''}</span></td>
                            <td class="px-6 py-4 text-sm text-gray-500">${project['sequencing-method'] || ''}</td>
                        `;
                        projectsTableBody.appendChild(row);
                    });
                } catch (error) {
                    console.warn('Could not fetch projects. Loading dummy data.', error);
                    projectsTableBody.innerHTML = '';
                    const dummyProjects = [
                        { id: 'URSA-2018-AK', 'project-name': 'Utikuma Region Study Area', year: '2018', 'project-lead': 'Arnold Kwok', status: 'Completed', 'sequencing-method': '16S Amplicon Sequencing' },
                        { id: 'FMM-16S-2020-TS', 'project-name': 'Fort McMurray 16S', year: '2020', 'project-lead': 'Timothy Shardlow', status: 'Completed', 'sequencing-method': '16S Amplicon Sequencing' },
                        { id: 'GR-eDNA-2018-GA', 'project-name': 'Glenmore Reservoir eDNA', year: '2018', 'project-lead': 'Ghadeer Aljoudi', status: 'Completed', 'sequencing-method': 'Environmental DNA' },
                    ];
                    dummyProjects.forEach(project => {
                        const row = document.createElement('tr');
                        const statusClass = project.status === 'Active' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800';
                        row.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-mono text-gray-600">${project.id}</div></td>
                            <td class="px-6 py-4 whitespace-nowrap"><div class="font-medium text-gray-900">${project['project-name']}</div></td>
                            <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-700">${project['project-lead']}</div></td>
                            <td class="px-6 py-4 whitespace-nowrap"><div class="text-sm text-gray-700">${project.year}</div></td>
                            <td class="px-6 py-4 whitespace-nowrap"><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">${project.status}</span></td>
                            <td class="px-6 py-4 text-sm text-gray-500">${project['sequencing-method']}</td>
                        `;
                        projectsTableBody.appendChild(row);
                    });
                }
            }

            loadMembers();
            loadProjects();
        });
    </script>

</body>
</html>
